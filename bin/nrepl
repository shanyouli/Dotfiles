#!/usr/bin/env bash

expr_str="import <nixpkgs> {}"
# shellcheck disable=SC2086
[[ ${DOTFILES:-0} == "0" ]] || {
    for i in /etc/nixos $HOME/.nixpkgs $HOME/.config/dotfiles $HOME/.dotfiles ; do
        if [[ -d $i ]]; then
            DOTFILES=$i
            break
        fi
    done
}
if [[ -n $DOTFILES ]]; then
    expr_str="${expr_str} // (builtins.getFlake \"${DOTFILES}\")"
fi
nix repl --expr "$expr_str"
