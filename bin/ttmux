#!/usr/bin/env bash

_tmux_config() {
    for dir in "$TMUX_HOME" "$XDG_CONFIG_HOME/tmux" "$HOME/.config/tmux" ; do
        [[ -f "$dir/tmux.conf" ]] && {
            echo "$dir/tmux.conf"
            break
        }
    done
}

case $TERMINAL in
    *st|*alacritty) termcmd="$TERMINAL -t tmux" ;;
    *) for cmd in "alacritty" "st" "xst" ; do
           command -v $cmd >/dev/null && terminal=$cmd
           break
       done
       if [[ ! $terminal ]] ; then
           echo "Please install xst or st or alacritty..."
           exit 1
       else
           termcmd="$terminal -t tmux"
       fi
       ;;
esac
if command -v tmux >/dev/null ; then
    term_args="-e tmux"
    if tmux ls | grep -qEv 'attached|scratch'; then
        term_args="$term_args at"
    else
        tmux_config=$(_tmux_config)
        [[ -n $tmux_config ]] && term_args="$term_args -f $tmux_config"
    fi
    termcmd="$termcmd $term_args"
fi
$termcmd
unset tmux_config term_args termcmd
